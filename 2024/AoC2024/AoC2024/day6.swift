//
//  day6.swift
//  AoC2024
//
//  Created by a on 06/12/2024.
//

class Day6 {
    
    let input1 = [
        "....#.....",
        ".........#",
        "..........",
        "..#.......",
        ".......#..",
        "..........",
        ".#..^.....",
        "........#.",
        "#.........",
        "......#...",
    ]
    
    let input2 = [
        "..........#...........#...........#.............................#......................#.........#................................",
        "..........................#.........#......#.................................#...........................#........................",
        "..................................#...#................................................................................#..........",
        ".#...............#.....#..........#.........#......#........#................................#......#.............................",
        "...#.......#.............#.............................................#.........##...............#.................#.............",
        ".......................................#.............#..................#........#.......#.........#...............#.........#....",
        ".....#..................#..#..#.........................#...................#....#........#.............................#.........",
        ".......#.............................#..........#......#..........................##......#.......................##..............",
        ".....#.....#........................................................................................#.......#.....................",
        ".................................#............#...#.....................................................#.........#...............",
        "...............#.....#..#....#....#.....................................................#............#........#.#.................",
        ".......#.....#...........................................................#............................#.................#....#....",
        "...........................#.................#....................................#...............#..#........................#...",
        ".....#.........................................#.................#...##....................................#......................",
        ".............#...#..................#......#.................#..........................................#.....#..........#........",
        ".................#...............#............#.......#.#...............................................#..................#......",
        ".....#..#.....................#.......................................................#..............#..............#.......##....",
        "..##........#....................................................#.............#..............#........................#..#.......",
        "..............................#...........#...#........................#............#..........................#........#........#",
        ".....................................##...............................#............#............#....#............................",
        "...##........................#.....#....#.........#.................................................#.............................",
        "...............................#................................#...............#.....#.....................#.....................",
        "................................................#..........#....#............................#.....#.......#..................#...",
        ".............#.....#.........#.#....#................##......#.............#......................................................",
        "..........#..............#..........#......#.........#...#.........................................#.#.....#.........#............",
        "..................#......................#.............................#...................#.....................................#",
        "................#.....#..............................#.............#.............#..#.....#....................................#..",
        ".........#.#................#.........#.................#...................#................................#................#...",
        ".............................................................#..............#.....................................................",
        "......#.........................#...........#.........#..................#....................................#..#...........##...",
        ".............................................................................#.............#........................#...#.........",
        "......#......#..#............#..............................................#....#..#..#................#.........#....#..........",
        "........#........#.........#....................................................^..#...#....................#...............#.....",
        "..#....#...#.......................................................................................................#..............",
        ".....#...........................................#..............#.........#....#........................................#.........",
        ".....................................#..............#............................................................#................",
        ".....#.......................#........................#..........#.............#.................#..................#.............",
        ".......................................#......#.....................................#.........................#...................",
        "...........................................................................................#............................##........",
        "..#............#..........................#...........#...#..................#......#.................#.#.................#......#",
        ".###......#....................#...#...........................................................#.........#.....#..............#.#.",
        "....................................#..........#.....#.......................#...............#.....#......#...................#...",
        "...#......#..................#......#.......#..............#..............#.......................................................",
        "..........#....................................................................#................##.#...#..........................",
        ".........................................................#..................##.....................#..##..........................",
        "..................#......#.................................#.................#.##................................................#",
        "...#..........#...#..#..............................................#...........................##........#.......................",
        ".....#................................................#...........#..................#...#.................................#......",
        ".......#.....#.........................#..........................................................................................",
        "....................................................#........#....#....................................##..............#.....#....",
        "............#........#.........................#.................................#..........................................#...#.",
        ".....................................#........................#...................#......#.#...........#..#..........#...........#",
        "................#...............#.........................#.........................#........#..#.................................",
        ".............#.........#.............#.#.#.........#...................#.......#.......................#..........................",
        ".............#......................................................#................................................#.......#....",
        "....#....................................................................#.#........#.................#..........................#",
        ".................................#......#....................................................................#.....#..............",
        "............##...................#.......................................................................#.........#........#.....",
        "#..................................................#..#...............#............#.............#...............................#",
        ".............................#.................................#.....#..........................#.............#..#...#...#........",
        "...#.....#..............................#.#......................................#................................................",
        "...#............##...............................#............#..............................#................................#...",
        "#.................#......##..............................................................#...........#........#...#...............",
        "....##.....................................................................................................#.#....................",
        "#.................#..................................................#..................................................#.........",
        ".........#.........#...........................#.................#.#.............................#................................",
        "................................#............#................................................................#...................",
        ".....................................#............................................#.##......##........#...........................",
        "....#....................................................#...#.#.#....................................................#...........",
        ".........................#.#...................#...................##...............#........................#....................",
        "..................................#...................................................................#.......#..................#",
        "...................#.............................................#.......................#.#.....................#....#...........",
        "#....................................#.#..#.#..........#.........#.........##.........#......................#............#.......",
        "...............................................................#.............................##....#.......#......................",
        ".............#......#.#.........#............................#............................#.......................................",
        "......................#.........#.........................................................#...#............#......................",
        "...................#.....#.....................................................#.....................................#............",
        "...............................#.....#..................#.......##................................................................",
        ".............................................#.........................#...........#..............................#..#............",
        "#..##..................................................................................................#......#...........#.....#.",
        ".......................................................#.....................#.............................#......................",
        "...........................................................................................................#......................",
        "......................#..............................................................#............................................",
        "...........................#.....#......................................#.........#........#..#.#.................................",
        ".#.......#........................................................................................................................",
        ".#.......#...........................................#................................#...........................................",
        ".........................................................#........................................#......#........................",
        "...............................#...#........#............................................#.................#......................",
        "......#.........................#......................#.....#.#..............#..................#.......#..................#.....",
        ".................#........#...#........................#.............................#............................................",
        "#...........................................................................#............................#................#.......",
        "..........................................................................#................#......................................",
        ".............#.............................................................................#.........................#............",
        ".#...........#.......#.......#.....#....#.......#........#....................#........................#........................#.",
        "...#..............#.............................#.............................................................#...#..#..........#.",
        "......#......#.#...............##................................................................................................#",
        "....#........#.##......#...#......................................................................................................",
        "..#..#.#.#.....................#................................#...................................#.....#...#...................",
        ".....................#.#........#..............##..............#.................#..............................................#.",
        "...................................................................................#........#.......#....#............#...........",
        ".....#....#..................#...............#.............................................#.#....................#...............",
        ".....................#..........#............#..................................#......................#.#.....#................#.",
        "..........#.........................................#...............#.............................................................",
        ".......#......................#.............#.....#..............#........................#.....#.........#.................#...#.",
        "..................................................................#.....#...............................................#........#",
        ".......#..........#.......#....#.......#..........#....#............................................#.#...........................",
        "..#...........#..............................#....................#....................#...#......................................",
        ".......#...............................#............#.....#.....................#.................................................",
        ".........#..................#..................#..................................................................................",
        "..........................................................................................#....#...................#.......##.....",
        "..................#.............................##.......................................................#.......#......#......#..",
        "...#.......#..............................................................................................#.......................",
        "............#..#..............................................................#...........##....#....#.#................#........#",
        "............#.........................#........#....#..#..................................#..................#....................",
        "......##......................#...##..............................#...............................................................",
        "........................#................#..............#...##...............................#..................##....#...........",
        "....#.#...#.....#..................................#..............................#...........#.....................#.............",
        "......................#.........................................................................#..........#.............#........",
        ".#......#............................................................#...............................#...#........................",
        ".......##.....................#.....#...........#......##.......##...................#...............................#............",
        "...#...#........#...............#......#......#.....#...#.................................................................#.......",
        "..................#.......................#...............................................#.................#.............#..#....",
        ".....................#.......#....#...#............................#.....................#............#.....................#.....",
        "................................................................#....#......#............#..................#.........#...........",
        ".......................#...................#..............................................................................###.....",
        "...............................#...........#................................#........#..#....#............................#.......",
        "....#......#...............................#...............#......................................#...............................",
        "...........#...........................##.........................................................................#.#.............",
        ".........................#.........#.........................................#.....#...................#.....#.......#............",
        ".............................#.....#................##..#.....................#...................................................",
    ]
    
    func parseMap(input: [String]) -> (obstacles: [[Bool]], visited: [[Bool]]) {
        var obstacles = [[Bool]]()
        var visited = [[Bool]]()
        
        for line in input {
            let obs = line.map { $0 == "." || $0 == "^" ? false : true }
            let vis = line.map { $0 == "^" ? true : false }
            obstacles.append(obs)
            visited.append(vis)
        }
        
        return (obstacles: obstacles, visited: visited)
    }
    
    func currentPos(input: [String]) -> (x: Int, y: Int) {
        let N = input.count
        let M = input[0].count
        
        for (i, line) in input.enumerated() {
            for (j, ch) in line.enumerated() {
                if (ch == "^") {
                    return (x: j, y: i)
                }
            }
        }
        
        fatalError()
    }
    
    func countVisited(visited: [[Bool]]) -> Int {
        return visited.map {  $0.filter { $0 }.count }.reduce(0, +)
    }
    
    func dowork() {
        let input = input2
        
        let N = input.count
        let M = input[0].count
        
        var (obstacles, visited) = parseMap(input: input)
        var position = currentPos(input: input)
        
        let directions: [(Int, Int)] = [
            (0, -1), // up
            (1, 0), // right
            (0, 1), // down
            (-1, 0), // left
        ]
        var dirIdx = 0
        
        while true {
            visited[position.y][position.x] = true
            let newX = position.x + directions[dirIdx].0
            let newY = position.y + directions[dirIdx].1
            
            if (newX < 0 || newX >= M || newY < 0 || newY >= N) {
                break
            }
            
            if obstacles[newY][newX] {
                dirIdx = (dirIdx + 1) % directions.count
            } else {
                position.x = newX
                position.y = newY
            }
        }
        
        print(countVisited(visited: visited))
    }
}
