//
//  Day7.swift
//  AoC2025
//
//  Created by a on 21/12/2025.
//

private let lines1: [String] = [
    ".......S.......",
    "...............",
    ".......^.......",
    "...............",
    "......^.^......",
    "...............",
    ".....^.^.^.....",
    "...............",
    "....^.^...^....",
    "...............",
    "...^.^...^.^...",
    "...............",
    "..^...^.....^..",
    "...............",
    ".^.^.^.^.^...^.",
    "...............",
]

private let lines2 = [
    "......................................................................S......................................................................",
    ".............................................................................................................................................",
    "......................................................................^......................................................................",
    ".............................................................................................................................................",
    ".....................................................................^.^.....................................................................",
    ".............................................................................................................................................",
    "....................................................................^...^....................................................................",
    ".............................................................................................................................................",
    "...................................................................^.^.^.^...................................................................",
    ".............................................................................................................................................",
    "..................................................................^.^.^...^..................................................................",
    ".............................................................................................................................................",
    ".................................................................^.^.^.^.^.^.................................................................",
    ".............................................................................................................................................",
    "................................................................^.^.^.^.^...^................................................................",
    ".............................................................................................................................................",
    "...............................................................^.^.^...^.^.^.^...............................................................",
    ".............................................................................................................................................",
    "..............................................................^.^.^.^.^.^...^.^..............................................................",
    ".............................................................................................................................................",
    ".............................................................^.^.......^...^.^.^.............................................................",
    ".............................................................................................................................................",
    "............................................................^.^.^.^.^...^.^.^.^.^............................................................",
    ".............................................................................................................................................",
    "...........................................................^.^.^.^.^.^.^.^...^.^.^...........................................................",
    ".............................................................................................................................................",
    "..........................................................^.....^.^.^.^.......^.^.^..........................................................",
    ".............................................................................................................................................",
    ".........................................................^...^.^.^.^.^...^.^.^.....^.........................................................",
    ".............................................................................................................................................",
    "........................................................^.....^.^.....^.^.^.^.....^.^........................................................",
    ".............................................................................................................................................",
    ".......................................................^...^.^.^.......^...^...^.^.^.^.......................................................",
    ".............................................................................................................................................",
    "......................................................^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^......................................................",
    ".............................................................................................................................................",
    ".....................................................^.^.^.^...^...^...........^.^.^.^.^.....................................................",
    ".............................................................................................................................................",
    "....................................................^.^...^.^.....^.^...^.^.^.^.^...^...^....................................................",
    ".............................................................................................................................................",
    "...................................................^.^...^...^...^...^.^.^.^.^...^.^.^.^.^...................................................",
    ".............................................................................................................................................",
    "..................................................^.....^.^.....^.^.^.^.^.^...^.^.....^.^.^..................................................",
    ".............................................................................................................................................",
    ".................................................^.^.^...^.^.^.....^.^.^.^.^.....^.^.^...^.^.................................................",
    ".............................................................................................................................................",
    "................................................^...^...^...^.^.^.........^.^.^.^.^.^.......^................................................",
    ".............................................................................................................................................",
    "...............................................^.^.^.^...^.^.^.......^.^.........^.^.^.^.....^...............................................",
    ".............................................................................................................................................",
    "..............................................^.^.^...^.^.^.^.^.^...^.^.....^.......^.^.^...^.^..............................................",
    ".............................................................................................................................................",
    ".............................................^.^.^.^.^.^...^.^.^.....^.^.^.^.^.^.^.....^.^.^.^.^.............................................",
    ".............................................................................................................................................",
    "............................................^.^.^...^.^.^.^.^.^.^...^.^.^.^...^.^.^.^.^.^...^.^.^............................................",
    ".............................................................................................................................................",
    "...........................................^.^.^.^.^.^.^.^.^.^...^.^.............^.^.^.........^.^...........................................",
    ".............................................................................................................................................",
    "..........................................^.^.^.....^.^.^.^...^.^.^.^.^.^...^.^.^.^.^.^...^.^.^...^..........................................",
    ".............................................................................................................................................",
    ".........................................^.^...^.^.^.^.^.^.......^.^...^.^.^.^...^...^.^.^...^.^.^.^.........................................",
    ".............................................................................................................................................",
    "........................................^.^.^.^.^.^...^...^.^.^.....^.^.^...^.^.^.^.^.^...^.^.^...^.^........................................",
    ".............................................................................................................................................",
    ".......................................^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.......^...^.^...^.^.^...^.......................................",
    ".............................................................................................................................................",
    "......................................^.^.^.^...^.^...^.^.^.^.^.^.^.^.^.....^.^...^.^.....^.^.^...^...^......................................",
    ".............................................................................................................................................",
    ".....................................^.^.^.^.^.^.^.^...^.^.^...^.....^.^...^.^.^.^.....^.^...^...^.^.^.^.....................................",
    ".............................................................................................................................................",
    "....................................^...^.^.^.....^.^.^.^.^...^...^...^.^.^.^.^.^.^...^.^.^.^.^...^...^.^....................................",
    ".............................................................................................................................................",
    "...................................^...^...^...^.^.^.....^.^...^.^.^.^.^.....^.^.^.^.^.^.....^...^.^.^...^...................................",
    ".............................................................................................................................................",
    "..................................^.^.^.^.^...^.....^.....^.......^.^.....^.^...^...^.^.^...^.....^.^.^.^.^..................................",
    ".............................................................................................................................................",
    ".................................^.^.....^.^.^.^.......^.......^.^.^.^.^.^...^.^...^.^.^...^...^.^...^.....^.................................",
    ".............................................................................................................................................",
    "................................^.^.^.^.^...^.^.^...^.^.^.^.^.^.^.^...^.^.^.^.....^.^.^.....^.^.^.^...^.....^................................",
    ".............................................................................................................................................",
    "...............................^.^...^.^.^...^...^.^.....^.....^.^.^.^...^.....^...^...^...^.^.^.^.^.....^.^.^...............................",
    ".............................................................................................................................................",
    "..............................^.^.....^.^.^.^...^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.......^.^.^.....^...^...^.^..............................",
    ".............................................................................................................................................",
    ".............................^.^.^.^.........^.....^.^.^...^...^.^.^.^.^...^...^.^.^.^.^.^.^...^.^.^.^...^.^...^.............................",
    ".............................................................................................................................................",
    "............................^.^.^.^.^.^.^.^...^.^.....^.^...^.^.^.^.^.....^.^.^.^...^.^.^.^.^...^...^...^...^.^.^............................",
    ".............................................................................................................................................",
    "...........................^.^...^.^.^.^.^.^...^.^.^.....^...^.^.^.^.^...^...^.^...^.^.......^.^.^...^.^.^.^.^.^.^...........................",
    ".............................................................................................................................................",
    "..........................^.^...^.^.^.^.^.^.^.........^.^...^.^.^.^.^.^.^.......^.^.^...^.^...^...^.^.^.^.^...^.^.^..........................",
    ".............................................................................................................................................",
    ".........................^.....^.^.^.^.^.^...^.^.^.^.....^.^.^...^.^.....^.^.^.^.^.^...^...^.^.....^.^.....^.^.^.^.^.........................",
    ".............................................................................................................................................",
    "........................^...^...^.^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^.....^.^...^...^...^.^.^.^.^.^.......^.^.^.^.^...^........................",
    ".............................................................................................................................................",
    ".......................^.^.^...^.^.......^.^.^.^.^.^...^.^.......^.^.^...^.^...^.^.^.^.^...^.^.^.^...^.^.^.^.^.^.^.^.^.......................",
    ".............................................................................................................................................",
    "......................^.^.^.^...^.^.^.^.^.^.^...^.......^.^...^...^...^...^...^...^.....^...^.^.^.^...^.^.^...^.^.^.^.^......................",
    ".............................................................................................................................................",
    ".....................^.^.^...^.^...^.^...^.....^...^.^.^.^.....^.^...^.^.^.^.....^...^.......^.^.^...^.....^.^.^.....^.^.....................",
    ".............................................................................................................................................",
    "....................^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.....^...^.^.^.^.^...^.^.^.^.^.^.^...^.^.......^...^.^.^.^.^.^.^.....^....................",
    ".............................................................................................................................................",
    "...................^.^.....^.....^...^.^...^...^...^.^.^...^.......^.^...^...^.^.^.^.^.^.^.^...^.^.^.^.^...^.^...^...^.^.^...................",
    ".............................................................................................................................................",
    "..................^...^.^.^.^.^.^.^.^.^.^.^.^.....^...^...^...^.^.^.^.^.^.^.^.^...^.....^...^...^.^.^.^.^.....^...^.^.^.^.^..................",
    ".............................................................................................................................................",
    ".................^.^.^.^.....^...^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.....^.^.^...^.^.^...^.......^.....^.^...^...^.......^.^.................",
    ".............................................................................................................................................",
    "................^.^...^.....^.^...^.^...^.^.^...^.^.^.^...^.^.^.^.....^.^...^.^...^.^...^.^.....^.^.^.....^.^.^.^.^.^...^...^................",
    ".............................................................................................................................................",
    "...............^.^.....^.^.^.^.^.^.^.^...^.^...^.^...^.^.^...^.^.....^.^...^.^.^.^.^.........^.^...^.^.^...^.^.^.....^...^.^.^...............",
    ".............................................................................................................................................",
    "..............^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.....^.^.^...^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.........^.^.^.^.^...^.^.^.^..............",
    ".............................................................................................................................................",
    ".............^.^.^.^.^.^...^.^.^.^...^.^.^.^.^.........^.^...^.^.^.....^.^...^.^.^...^.^.^...^.^...^...^...^...^.^.^.^.^.^...^.^.............",
    ".............................................................................................................................................",
    "............^.^.....^.^...^.^.^.^.......^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^...^.^.^...^.^...^.^.^...^.^.^.^.^.^.^...^............",
    ".............................................................................................................................................",
    "...........^.^.^...^.^.^.^.^...^...^.^.^.....^.^...^.^.^...^.^.^...^.^.^.^...^...^.^.....^...^.^.....^.^.^.^.^.^.^.^...^.......^.^...........",
    ".............................................................................................................................................",
    "..........^.^.^.^.^.^...^...^.^.^.^.^.^.....^.^.^.^.^...^...^.^.^...^.^.^.^.^...^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^.....^.^.^.......^..........",
    ".............................................................................................................................................",
    ".........^.^.^.^.^...^.^...^...^.....^.^...^.^...^.^.^.^.^.^.........^.^.^.^.^...^.^.^...^.^.^.^.^...^.....^.^.^.^.^.^.^.^.^.^.^...^.........",
    ".............................................................................................................................................",
    "........^...^.....^.^.......^...^.^.^.^.....^.^.^.^.......^.^...^.^.^.^.^.^.^.^.^.^.^.....^...^.^.....^...^.^.^.^.^...^...^.....^.^.^........",
    ".............................................................................................................................................",
    ".......^.^.^.^.^.^...^.^.^...^.^...^...^.......^.^.^.^.^.^...^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.....^.^.^.^...^.^.^.......",
    ".............................................................................................................................................",
    "......^.^.^.^.......^.^.^.^.....^.^.^...^.^.^.^.^...^...^...^.^.^.........^.....^.^.^.^.^.^.....^.......^.^.......^.....^.^.^.^.^.....^......",
    ".............................................................................................................................................",
    ".....^.^.^.^.....^.^.^...^...^.......^.^...^.....^.^.^.^.^...^...^.^.^.^...^.^.^.^.^.^.^.^.^...^.......^...^.........^.^.^.^...^.^...^.^.....",
    ".............................................................................................................................................",
    "....^.^.^.^.^.^.^.^.^.^...^.^...^.^.^...^.^.^.^...^.^...^.^.^.^...^...^.^.^.^.^.^.^...^.^.^...^.......^.^.^.^.^.^.^.^.^.^.^.^...^.^.^...^....",
    ".............................................................................................................................................",
    "...^...^.^.^.^...^.^...^.^.....^.^.^.^.^.^.^.^.^.....^.^.^...^...^.^.^.^.^...^...^.^.^.^...^.^.^.^.^...^...^.^.^.^.^...^.^.^.^.....^.....^...",
    ".............................................................................................................................................",
    "..^.^...^...^.^.^.^...^.^.^...^.^.^.^.^.....^...^...^.^.^.....^.^.....^.^.^...^.....^.^...^.^.^.^...^.......^.^.....^.^.......^.^.......^.^..",
    ".............................................................................................................................................",
    ".^...^.^.^.^.^.^.....^.^.^.........^.^...^.^.^.^...^.^.^.^...^.^.........^.^...^.....^...^.^.^.^.^.^.^...^...^.^.^.........^.^.^.^.^.^.^.^.^.",
    ".............................................................................................................................................",
]

class Day7 {
    fileprivate enum Step: String {
        case down = "S"
        case empty = "."
        case splitter = "^"
    }

    func doWork(lines: [String] = lines2) {
        var result = 0

        var map = parse(lines: lines)
        for i in 1..<map.count {
            for j in 0..<map[i].count {
                let current = map[i][j]

                switch current {
                case .down:
                    continue
                case .empty:
                    if map[i - 1][j] == .down {
                        map[i][j] = .down
                    }

                case .splitter:
                    if map[i - 1][j] == .down {
                        var splt = false

                        if j - 1 >= 0 && i + 1 < map.count && map[i + 1][j - 1] != .down {
                            map[i + 1][j - 1] = .down
                            splt = true
                        }

                        if j + 1 < map[i].count && i + 1 < map.count && map[i + 1][j + 1] != .down {
                            map[i + 1][j + 1] = .down
                            splt = true
                        }

                        if splt { result += 1 }
                    }
                }
            }
        }

        print(result)

        for row in map {
            print(row.map { $0.debugDescription.replacing("S", with: "|") }.joined())
        }
    }

    fileprivate func parse(lines: [String]) -> [[Step]] {
        var result = [[Step]]()

        for line in lines {
            let row = line.compactMap { Step(rawValue: String($0)) }
            result.append(row)
        }

        return result
    }
}

extension Day7.Step: CustomDebugStringConvertible {
    var debugDescription: String {
        self.rawValue
    }
}
